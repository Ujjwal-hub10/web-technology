"use strict";(globalThis.webpackChunkcalypso=globalThis.webpackChunkcalypso||[]).push([[18821],{"./lib/media/constants.js":(e,t,a)=>{a.d(t,{qf:()=>i,No:()=>s,NC:()=>n,JW:()=>o,IG:()=>r,n2:()=>d,VS:()=>p,Ys:()=>c,$o:()=>m,Dn:()=>l,Qs:()=>u});const i={FILE_TYPE_UNSUPPORTED:"FILE_TYPE_UNSUPPORTED",FILE_TYPE_NOT_IN_PLAN:"FILE_TYPE_NOT_IN_PLAN",SERVER_ERROR:"SERVER_ERROR",UPLOAD_VIA_URL_404:"UPLOAD_VIA_URL_404",EXCEEDS_MAX_UPLOAD_SIZE:"EXCEEDS_MAX_UPLOAD_SIZE",EXCEEDS_PLAN_STORAGE_LIMIT:"EXCEEDS_PLAN_STORAGE_LIMIT",NOT_ENOUGH_SPACE:"NOT_ENOUGH_SPACE",SERVICE_FAILED:"SERVICE_FAILED",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE",SERVICE_AUTH_FAILED:"SERVICE_AUTH_FAILED"},s={thumbnail:{width:150,height:150},medium:{width:300,height:300},large:{width:1024,height:1024}},n=["ogv","mp4","m4v","mov","wmv","avi","mpg","3gp","3g2"],o=["default","circle","square"],r=["default"],d={items:[],type:"default",columns:3,orderBy:"menu_order",link:"",size:"thumbnail"},p={jpg:"image/jpeg",jpeg:"image/jpeg",jpe:"image/jpeg",gif:"image/gif",png:"image/png",bmp:"image/bmp",tif:"image/tiff",tiff:"image/tiff",ico:"image/x-icon",asf:"video/x-ms-asf",asx:"video/x-ms-asf",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wm:"video/x-ms-wm",avi:"video/avi",divx:"video/divx",flv:"video/x-flv",mov:"video/quicktime",qt:"video/quicktime",mpeg:"video/mpeg",mpg:"video/mpeg",mpe:"video/mpeg",mp4:"video/mp4",m4v:"video/mp4",ogv:"video/ogg",webm:"video/webm",mkv:"video/x-matroska",txt:"text/plain",asc:"text/plain",c:"text/plain",cc:"text/plain",h:"text/plain",csv:"text/csv",tsv:"text/tab-separated-values",ics:"text/calendar",rtx:"text/richtext",css:"text/css",htm:"text/html",html:"text/html",mp3:"audio/mpeg",m4a:"audio/mpeg",m4b:"audio/mpeg",ra:"audio/x-realaudio",ram:"audio/x-realaudio",wav:"audio/wav",ogg:"audio/ogg",oga:"audio/ogg",mid:"audio/midi",midi:"audio/midi",wma:"audio/x-ms-wma",wax:"audio/x-ms-wax",mka:"audio/x-matroska",rtf:"application/rtf",js:"application/javascript",pdf:"application/pdf",swf:"application/x-shockwave-flash",class:"application/java",tar:"application/x-tar",zip:"application/zip",gz:"application/x-gzip",gzip:"application/x-gzip",rar:"application/rar","7z":"application/x-7z-compressed",exe:"application/x-msdownload",doc:"application/msword",pot:"application/vnd.ms-powerpoint",pps:"application/vnd.ms-powerpoint",ppt:"application/vnd.ms-powerpoint",wri:"application/vnd.ms-write",xla:"application/vnd.ms-excel",xls:"application/vnd.ms-excel",xlt:"application/vnd.ms-excel",xlw:"application/vnd.ms-excel",mdb:"application/vnd.ms-access",mpp:"application/vnd.ms-project",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",docm:"application/vnd.ms-word.document.macroEnabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dotm:"application/vnd.ms-word.template.macroEnabled.12",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.12",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xltm:"application/vnd.ms-excel.template.macroEnabled.12",xlam:"application/vnd.ms-excel.addin.macroEnabled.12",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",pptm:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppsm:"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",potm:"application/vnd.ms-powerpoint.template.macroEnabled.12",ppam:"application/vnd.ms-powerpoint.addin.macroEnabled.12",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",sldm:"application/vnd.ms-powerpoint.slide.macroEnabled.12",onetoc:"application/onenote",onetoc2:"application/onenote",onetmp:"application/onenote",onepkg:"application/onenote",odt:"application/vnd.oasis.opendocument.text",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odg:"application/vnd.oasis.opendocument.graphics",odc:"application/vnd.oasis.opendocument.chart",odb:"application/vnd.oasis.opendocument.database",odf:"application/vnd.oasis.opendocument.formula",wp:"application/wordperfect",wpd:"application/wordperfect",key:"application/vnd.apple.keynote",numbers:"application/vnd.apple.numbers",pages:"application/vnd.apple.pages"},c="MEDIA_IMAGE_THUMBNAIL",m="MEDIA_IMAGE_RESIZER",l=[.077,.115,.157,.24,.323],u=.323},"./state/media/init.js":(e,t,a)=>{var i=a("./state/redux-store.ts"),s=a("../packages/state-utils/src/index.ts"),n=a("../node_modules/lodash-es/pickBy.js"),o=a("../node_modules/lodash-es/mapValues.js"),r=a("../node_modules/lodash-es/without.js"),d=a("../node_modules/lodash-es/isEmpty.js"),p=a("../node_modules/lodash-es/omit.js"),c=a("../node_modules/lodash-es/merge.js"),m=a("../node_modules/lodash-es/isEqual.js"),l=a("./lib/media/constants.js");const u=function(e){return"string"==typeof e&&e.startsWith("media-")};var I=a("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),E=a("../node_modules/moment/moment.js"),_=a.n(E),v=a("./lib/query-manager/paginated/index.js");const x={context:"display",http_envelope:!1,pretty:!1,number:20,offset:0,page:1,order:"DESC",order_by:"date",mime_type:"",search:""};var f=a("./lib/query-manager/paginated/key.js");class g extends f.Z{}(0,I.Z)(g,"DEFAULT_QUERY",x),(0,I.Z)(g,"OMIT_NULL_VALUES",!0);class h extends v.Z{static matches(e,t){return Object.entries({...this.DefaultQuery,...e}).every((([e,a])=>{switch(e){case"search":return!a||t.title&&t.title.toLowerCase().includes(a.toLowerCase());case"mime_type":return!a||new RegExp(`^${a.replace(/(^%|(\/)%?)$/,"$2.+").split("/").map((e=>e.replace(/[^-*.+a-zA-Z0-9]/g,""))).concat(".+").slice(0,2).join("/")}$`).test(t.mime_type);case"post_ID":return a===t.post_ID;case"after":case"before":{const i=_()(a,_().ISO_8601),s=/after$/.test(e)?"isAfter":"isBefore";return i.isValid()&&_()(t.date)[s](i)}}return!0}))}static compare(e,t,a){let i;switch(e.order_by){case"ID":i=t.ID-a.ID;break;case"title":i=t.title.localeCompare(a.title);break;default:i=_()(t.date).diff(a.date)}return e.order&&!/^desc$/i.test(e.order)||(i*=-1),i||0}}(0,I.Z)(h,"QueryKey",g),(0,I.Z)(h,"DefaultQuery",x);var w=a("./lib/query-manager/with-query-manager.js"),A=a("./state/action-types.ts");const b=(e,t,a)=>{const{[t]:{transientItems:i={},transientIdsToServerIds:s={}}={}}=e;return{...e,[t]:a({transientItems:i,transientIdsToServerIds:s})}};var y=a("./state/utils/reducer-utils.ts");const L=(0,y.U)({errors:(e={},t)=>{switch(t.type){case A.zOw:{const{siteId:a,mediaId:i,errors:s}=t;return{...e,[a]:{...e[a],[i]:s}}}case A.F1b:case A.LEq:{if(!(e=>{return e.error&&(e.siteId||(t=e.error).error&&("servicefail"===t.error||"keyring_token_error"===t.error));var t})(t))return e;const a=(Array.isArray(t.error.errors)?t.error.errors:[t.error]).map((e=>{switch(e.error){case"http_404":return l.qf.UPLOAD_VIA_URL_404;case"rest_upload_limited_space":return l.qf.NOT_ENOUGH_SPACE;case"rest_upload_file_too_big":return l.qf.EXCEEDS_MAX_UPLOAD_SIZE;case"rest_upload_user_quota_exceeded":return l.qf.EXCEEDS_PLAN_STORAGE_LIMIT;case"upload_error":return l.qf.SERVER_ERROR;case"keyring_token_error":return l.qf.SERVICE_AUTH_FAILED;case"servicefail":return l.qf.SERVICE_FAILED;case"service_unavailable":return l.qf.SERVICE_UNAVAILABLE;default:return l.qf.SERVER_ERROR}}));return{...e,[t.siteId]:{...e[t.siteId],[t?.mediaId??0]:a}}}case A.c0z:return t.siteId?{...e,[t.siteId]:(0,n.Z)((0,o.Z)(e[t.siteId],(e=>(0,r.Z)(e,t.errorType))),(e=>!(0,d.Z)(e)))}:e;case A.LEd:return t.siteId&&t.mediaId?{...e,[t.siteId]:{...(0,p.Z)(e[t.siteId],[[t.siteId],[t.mediaId]])}}:e;case A.EzY:return t.siteId?(0,p.Z)(e,t.siteId):e}return e},queries:(e={},t)=>{switch(t.type){case A.iG7:{const{siteId:a,media:i,found:s,query:n}=t;return(0,w.Z)(e,a,(e=>e.receive(i,{found:s,query:n})),(()=>new h))}case A.aqr:{const{siteId:a,mediaIds:i}=t;return(0,w.Z)(e,a,(e=>e.removeItems(i)))}case A.QdR:{const{siteId:a,mediaItem:i}=t;return(0,w.Z)(e,a,(e=>e.receive(i,{patch:!0})))}case A.EzY:case A._Ck:return t.siteId?(0,p.Z)(e,t.siteId):e}return e},selectedItems:(e={},t)=>{switch(t.type){case A.EzY:{const{siteId:a}=t;return{...e,[a]:[]}}case A.OtT:{const{media:a,siteId:i}=t;return{...e,[i]:a.map((e=>e.ID))}}case A.TuQ:{const{site:a,transientMedia:i}=t;return t.site&&t.transientMedia?{...e,[a.ID]:[...e[a.ID]??[],i.ID]}:e}case A.iG7:{const{media:a,siteId:i}=t;if(t.found||t.query)return e;const{[i]:s=[]}=e,n=a.reduce(((e,t)=>s.includes(t.ID)?e:[...e,t.ID]),[...s]);return{...e,[i]:n}}case A.l44:{const{mediaId:a,siteId:i}=t;if(!u(a))return e;const s=e[i]??[];return{...e,[i]:s.filter((e=>a!==e))}}case A.aqr:{const{mediaIds:a,siteId:i}=t;return{...e,[i]:e[i].filter((e=>!a.includes(e)))}}}return e},transientItems:(e={},t)=>{switch(t.type){case A.EzY:return b(e,t.siteId,(()=>({transientItems:{},transientIdsToServerIds:{}})));case A.TuQ:{const{site:{ID:a},transientMedia:i}=t;return b(e,a,(({transientItems:e,...t})=>({...t,transientItems:{...e,[i.ID]:i}})))}case A.iG7:{const{siteId:a,media:i}=t,s=i.filter((e=>null!=e.transientId));if(0===s.length)return e;const n=s.map((e=>e.transientId)),o=s.reduce(((e,t)=>({...e,[t.transientId]:t.ID})),{});return b(e,a,(({transientIdsToServerIds:e,transientItems:t})=>({transientIdsToServerIds:{...e,...o},transientItems:(0,p.Z)(t,n)})))}case A.F1b:{const{siteId:a,mediaId:i}=t;return b(e,a,(({transientItems:e,...t})=>({...t,transientItems:(0,p.Z)(e,i)})))}}return e},fetching:(e={},t)=>{switch(t.type){case A.sZU:{const a=t.siteId;return{...e,[a]:Object.assign({},e[a],{nextPage:!0})}}case A.P4e:case A.LEq:{const a=t.siteId;return{...e,[a]:Object.assign({},e[a],{nextPage:!1})}}case A.Jfv:{const{siteId:a,mediaRequestMeta:i}=t;return{...e,[a]:(0,c.Z)({},e[a],{nextPageHandle:i?.next_page||null})}}case A.AsP:{const{siteId:a,query:i}=t,s={...e[a],query:i};return(0,m.Z)(i,e[a]?.query)||(delete s.nextPageHandle,s.nextPage=!1),{...e,[a]:s}}}return e}}),R=(0,s.xi)("media",L);(0,i.x)(["media"],R)}}]);