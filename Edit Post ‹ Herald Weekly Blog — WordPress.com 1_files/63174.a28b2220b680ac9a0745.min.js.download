"use strict";(globalThis.webpackChunkcalypso=globalThis.webpackChunkcalypso||[]).push([[63174],{"./blocks/all-sites/index.jsx":(e,s,t)=>{t.d(s,{Z:()=>f});var i=t("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=t("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=t("../packages/calypso-config/src/index.ts"),l=t("../node_modules/classnames/index.js"),r=t.n(l),a=t("../packages/i18n-calypso/src/localize.js"),c=t("../node_modules/react/index.js"),h=t("../node_modules/react-redux/es/index.js"),d=t("./components/count/index.jsx"),u=t("./state/current-user/selectors.js"),p=t("./state/selectors/get-sites.js"),g=t("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const m=(0,o.Z)("div",{target:"eq1p8wa0"})({name:"1by10yi",styles:"align-items:center;align-self:center;border-radius:0;display:inline-flex;margin-inline-end:8px;padding:0;height:32px;width:32px;justify-content:center;color:var(--color-sidebar-text)"});class S extends c.Component{constructor(...e){super(...e),(0,i.Z)(this,"onSelect",(e=>{this.props.onSelect(e)}))}renderIcon(){return this.props.icon?(0,g.tZ)(m,{children:this.props.icon}):null}renderSiteCount(){return(0,g.tZ)(d.Z,{count:this.props.count})}render(){const{title:e,href:s,domain:t,translate:i,isHighlighted:o,isSelected:n,showCount:l,showIcon:a}=this.props,c=r()({"all-sites":!0,"is-selected":n,"is-highlighted":o});return(0,g.tZ)("div",{className:c,children:(0,g.BX)("a",{className:"all-sites__content site__content",href:s,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,onClick:this.onSelect,children:[l&&this.renderSiteCount(),a&&this.renderIcon(),(0,g.BX)("div",{className:"all-sites__info site__info",children:[(0,g.tZ)("span",{className:"all-sites__title site__title",children:e||i("All My Sites")}),t&&(0,g.tZ)("span",{className:"all-sites__domain site__domain",children:t})]})]})})}}(0,i.Z)(S,"defaultProps",{onSelect:()=>{},href:null,isSelected:!1,isHighlighted:!1,showCount:!0,showIcon:!1,domain:""});const b=({visible:e=!0})=>e,f=(0,h.$j)(((e,s)=>{const t=(0,p.Z)(e)?.filter(b),i=s.count??(0,u.f0)(e);return{count:n.ZP.isEnabled("realtime-site-count")?t.length:i}}))((0,a.Z)(S))},"./components/site-selector/index.jsx":(e,s,t)=>{t.d(s,{Z:()=>ie});var i=t("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=t("../packages/calypso-url/src/url-type.ts"),n=t("../packages/calypso-url/src/url-parts.ts"),l=t("../packages/calypso-url/src/format.ts"),r=t("../packages/components/src/button/index.tsx"),a=t("../packages/search/src/search.tsx"),c=t("../node_modules/classnames/index.js"),h=t.n(c),d=t("../node_modules/debug/src/browser.js"),u=t.n(d),p=t("../packages/i18n-calypso/src/localize.js"),g=t("../node_modules/lodash-es/flow.js"),m=t("../node_modules/page/page.js"),S=t.n(m),b=t("../node_modules/react/index.js"),f=t("../node_modules/react-dom/index.js"),v=t("../node_modules/react-redux/es/index.js"),Z=t("./blocks/all-sites/index.jsx"),_=t("./blocks/site/placeholder.jsx"),y=t("./components/search/index.jsx"),w=t("./lib/scroll-into-viewport/index.js"),j=t("./lib/url/add-query-args.ts"),k=t("./my-sites/sidebar/static-data/all-sites-menu.js"),x=t("./state/analytics/actions/record.js"),M=t("./state/current-user/selectors.js"),I=t("./state/selectors/are-all-sites-single-user.js"),H=t("./state/selectors/can-any-site-have-plugins.ts"),C=t("./state/selectors/get-sites.js"),T=t("./state/selectors/get-visible-sites.js"),P=t("./state/selectors/has-loaded-sites.js"),E=t("../node_modules/@wordpress/compose/build-module/utils/create-higher-order-component/index.js"),N=t("./state/sites/hooks/use-sites-sorting.ts"),A=t("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const R=(0,E.o)((e=>s=>(0,A.tZ)(e,{...s,...(0,N.ph)()})),"withSitesSortingPreference");var L=t("./state/sites/selectors/get-site.js"),D=t("./state/sites/selectors/has-all-sites-list.js"),B=t("./state/ui/selectors/get-selected-site.ts"),K=t("../packages/i18n-calypso/src/use-translate.js"),V=t("./lib/jetpack/is-jetpack-cloud.ts"),X=t("./lib/paths/index.js"),O=t("./state/ui/selectors/get-selected-site-slug.js");const U=()=>{const e=(0,K.Z)(),s=(0,v.I0)(),t=(0,v.v9)(O.Z),i=(0,b.useCallback)((()=>{const e=(0,V.Z)()?"calypso_add_new_jetpack_click":"calypso_add_new_wordpress_click";s((0,x.jN)(e))}),[s]);return(0,A.tZ)(r.Z,{primary:!0,href:(0,j.Z)({ref:"calypso-selector",source:"my-home",siteSlug:t},(0,X.Nf)()),onClick:i,children:e("Add new site")})};var Y=t("../packages/sites/src/create-sites-list-component.ts"),$=t("../node_modules/@wordpress/element/build-module/create-interpolate-element.js"),F=t("../node_modules/@wordpress/i18n/build-module/index.js"),q=t("../node_modules/@wordpress/react-i18n/build-module/index.js"),z=t("./blocks/site/index.jsx");const W=(0,Y.J)({grouping:!1}),G=R((({searchTerm:e,maxResults:s,sitesSorting:t,addToVisibleSites:i,isReskinned:o,sites:n,onSelect:l,indicator:r,onMouseEnter:a,isHighlighted:c,isSelected:h})=>{const{__:d}=(0,q.QT)();return(0,A.tZ)(W,{filtering:{search:e},sites:n,sorting:t,children:({sites:e})=>{if(0===e.length)return(0,A.tZ)("div",{className:"site-selector__no-results",children:d("No sites found")});const t=null!=s?e.slice(0,s):e;return(0,A.BX)(A.HY,{children:[t.map((e=>(i(e.ID),(0,A.tZ)(z.Z,{site:e,indicator:r,onSelect:l,onMouseEnter:a,isHighlighted:c(e.ID),isSelected:h(e),isReskinned:o},"site-"+e.ID)))),t.length<e.length&&(0,A.tZ)("span",{className:"site-selector__list-bottom-adornment",children:(0,$.Z)((0,F.gB)(d("Only displaying the first %(maxResults)d sites.<br />Use search to refine."),{maxResults:s}),{br:(0,A.tZ)("br",{})})})]})}})}));var J=t("./components/site-selector/utils.ts");const Q="ALL_SITES",ee=()=>{},se=u()("calypso:site-selector");class te extends b.Component{constructor(...e){super(...e),(0,i.Z)(this,"state",{highlightedIndex:-1,showSearch:!1,isKeyboardEngaged:!1,searchTerm:""}),(0,i.Z)(this,"onSearch",(e=>{const s=e.trim();this.setState({highlightedIndex:e?0:-1,showSearch:!!s||this.state.showSearch,isKeyboardEngaged:!0,searchTerm:s})})),(0,i.Z)(this,"onKeyDown",(e=>{const s=this.visibleSites.length;if(0===s||e.shiftKey)return;const{highlightedSiteId:t,highlightedIndex:i}=this.computeHighlightedSite();let o=null;switch(e.key){case"ArrowUp":o=i-1,o<0&&(o=s-1);break;case"ArrowDown":o=i+1,o>=s&&(o=0);break;case"Enter":t&&(t===Q?this.onSiteSelect(e,Q):this.onSiteSelect(e,t))}null!==o&&(this.lastMouseHover=null,this.setState({highlightedIndex:o,isKeyboardEngaged:!0}))})),(0,i.Z)(this,"onSiteSelect",((e,s)=>{if(s!==Q){const e=this.visibleSites.filter((e=>e!==Q));this.props.recordTracksEvent("calypso_switch_site_click_item",{position:e.indexOf(s)+1,list_item_count:e.length,is_searching:this.state.searchTerm.length>0,sort_key:this.props.sitesSorting.sortKey,sort_order:this.props.sitesSorting.sortOrder})}const t=this.props.onSiteSelect(s);if(this.props.onClose(e,s),!this.siteSelectorRef)return;const i=f.findDOMNode(this.siteSelectorRef);i&&(i.scrollTop=0),t||this.props.navigateToSite(s,this.props)})),(0,i.Z)(this,"onAllSitesSelect",((e,s)=>{this.props.recordTracksEvent("calypso_all_my_sites_click",s),this.onSiteSelect(e,Q)})),(0,i.Z)(this,"onManageSitesClick",(()=>{this.props.recordTracksEvent("calypso_manage_sites_click")})),(0,i.Z)(this,"onSiteHover",((e,s)=>{this.lastMouseHover!==s&&(se(`${s} hovered`),this.lastMouseHover=s)})),(0,i.Z)(this,"onAllSitesHover",(()=>{this.lastMouseHover!==Q&&(se("ALL_SITES hovered"),this.lastMouseHover=Q)})),(0,i.Z)(this,"onMouseLeave",(()=>{se("mouse left site selector - nothing hovered anymore"),this.lastMouseHover=null})),(0,i.Z)(this,"onMouseMove",(e=>{e.pageX===this.lastMouseMoveX&&e.pageY===this.lastMouseMoveY||(this.lastMouseMoveY=e.pageY,this.lastMouseMoveX=e.pageX,this.state.isKeyboardEngaged&&this.setState({isKeyboardEngaged:!1}))})),(0,i.Z)(this,"isSelected",(e=>{const s=this.props.selected||this.props.selectedSite;return e===Q&&null===s||s===e.ID||s===e.domain||s===e.slug})),(0,i.Z)(this,"isHighlighted",(e=>this.state.isKeyboardEngaged&&this.visibleSites.indexOf(e)===this.state.highlightedIndex)),(0,i.Z)(this,"setSiteSelectorRef",(e=>this.siteSelectorRef=e)),(0,i.Z)(this,"mapAllSitesPath",(e=>e.includes("/posts/my")?e.replace("/posts/my","/posts"):e))}componentDidUpdate(e,s){this.state.isKeyboardEngaged&&s.highlightedIndex!==this.state.highlightedIndex&&this.scrollToHighlightedSite()}scrollToHighlightedSite(){if(!this.siteSelectorRef)return;const e=f.findDOMNode(this.siteSelectorRef);if(!e)return;const s=e.querySelector(".site.is-highlighted, .site-selector .all-sites.is-highlighted");s&&(0,w.Z)(s,{block:"nearest",scrollMode:"if-needed"})}computeHighlightedSite(){let e,s;return this.state.isKeyboardEngaged?(se("using highlight from last keyboard interaction"),e=this.visibleSites[this.state.highlightedIndex],s=this.state.highlightedIndex):this.lastMouseHover?(se(`restoring highlight from last mouse hover (${this.lastMouseHover})`),e=this.props.highlightedSiteId||this.lastMouseHover,s=this.visibleSites.indexOf(e)):(se("resetting highlight as mouse left site selector"),e=null,s=-1),{highlightedSiteId:e,highlightedIndex:s}}shouldShowGroups(){return this.props.groups}sitesToBeRendered(){let e=this.state.searchTerm||this.props.showHiddenSites?this.props.sites:this.props.visibleSites;return this.props.filter&&(e=e.filter(this.props.filter)),this.props.hideSelected&&this.props.selected&&(e=e.filter((e=>e.slug!==this.props.selected))),e}renderAllSites(){if(!this.props.showAllSites||this.state.searchTerm||!this.props.allSitesPath)return null;const e=(0,k.Z)({showManagePlugins:this.props.hasSiteWithPlugins}).find((e=>e.url===this.mapAllSitesPath(this.props.allSitesPath)));if(this.props.showManageSitesButton&&!e)return null;if(this.props.showManageSitesButton&&!this.props.selectedSite)return null;this.visibleSites.push(Q);const s=this.isHighlighted(Q);return(0,A.tZ)(Z.Z,{onSelect:s=>this.onAllSitesSelect(s,e?{multi_site_context_slug:e.slug}:void 0),onMouseEnter:this.onAllSitesHover,isHighlighted:s,isSelected:this.isSelected(Q),title:e&&e.navigationLabel,showCount:!e?.icon,showIcon:!!e?.icon,icon:e?.icon&&(0,A.tZ)("span",{className:"dashicons-before "+e.icon,"aria-hidden":!0})},"selector-all-sites")}renderSites(e){return this.props.hasAllSitesList?(0,A.tZ)(G,{maxResults:this.props.maxResults,addToVisibleSites:e=>this.visibleSites.push(e),searchTerm:this.state.searchTerm,sites:e,indicator:this.props.indicator,onSelect:this.onSiteSelect,onMouseEnter:this.onSiteHover,isHighlighted:this.isHighlighted,isSelected:this.isSelected,isReskinned:this.props.isReskinned}):(0,A.tZ)(_.Z,{},"site-placeholder")}render(){if(this.props.isPlaceholder)return(0,A.tZ)("div",{className:"site-selector"});const e=this.props.siteCount-this.props.visibleSiteCount,s=h()("site-selector","sites-list",this.props.className,{"is-large":this.props.siteCount>6||e>0||this.state.showSearch,"is-single":1===this.props.visibleSiteCount,"is-hover-enabled":!this.state.isKeyboardEngaged});this.visibleSites=[];const t=this.sitesToBeRendered(),i=this.props.isReskinned?a.Z:y.ZP;return(0,A.BX)("div",{className:s,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave,children:[(0,A.tZ)(i,{onSearch:this.onSearch,placeholder:this.props.searchPlaceholder,autoFocus:this.props.autoFocus,disabled:!this.props.hasLoadedSites,onSearchClose:this.props.onClose,onKeyDown:this.onKeyDown,isReskinned:this.props.isReskinned}),(0,A.BX)("div",{className:"site-selector__sites",ref:this.setSiteSelectorRef,children:[this.renderAllSites(),this.renderSites(t),!this.props.showHiddenSites&&e>0&&!this.state.searchTerm&&(0,A.tZ)("span",{className:"site-selector__list-bottom-adornment",children:this.props.translate("%(hiddenSitesCount)d more hidden site. {{a}}Change{{/a}}.{{br/}}Use search to access it.","%(hiddenSitesCount)d more hidden sites. {{a}}Change{{/a}}.{{br/}}Use search to access them.",{count:e,args:{hiddenSitesCount:e},components:{br:(0,A.tZ)("br",{}),a:(0,A.tZ)("a",{href:"https://dashboard.wordpress.com/wp-admin/index.php?page=my-blogs&show=hidden",target:"_blank",rel:"noopener noreferrer"})}})})]}),(this.props.showManageSitesButton||this.props.showAddNewSite)&&(0,A.BX)("div",{className:"site-selector__actions",children:[this.props.showManageSitesButton&&(0,A.tZ)(r.Z,{transparent:!0,onClick:this.onManageSitesClick,href:(0,j.Z)({search:this.state.searchTerm.length>0?this.state.searchTerm:null},"/sites"),children:this.props.translate("Manage sites")}),this.props.showAddNewSite&&(0,A.tZ)(U,{})]})]})}}(0,i.Z)(te,"defaultProps",{sites:{},showManageSitesButton:!1,showAddNewSite:!1,showAllSites:!1,showHiddenSites:!1,siteBasePath:!1,indicator:!1,hideSelected:!1,selected:null,onClose:ee,onSiteSelect:ee,groups:!1,autoFocus:!1});const ie=(0,g.Z)(p.Z,R,(0,v.$j)((e=>{const s=(0,M.ts)(e);return{hasLoadedSites:(0,P.Z)(e),sites:(0,C.Z)(e,!1),siteCount:(0,J.h)(s),visibleSiteCount:(0,J.D)(s),selectedSite:(0,B.Z)(e),visibleSites:(0,T.Z)(e),allSitesSingleUser:(0,I.Z)(e),hasAllSitesList:(0,D.Z)(e),hasSiteWithPlugins:(0,H.y)(e)}}),{navigateToSite:(e,{allSitesPath:s,allSitesSingleUser:t,siteBasePath:i})=>(r,a)=>{const c=a(),h=(0,L.Z)(c,e),d=function(){if(se("getPathnameForSite",e,h),e===Q){const e=t?"/posts":"/posts/my",i=s.replace(/^\/posts\b(\/my)?/,e);return i.match(/^\/stats\/insights\/?/)?"/stats/day":i.match(/^\/backup\/.*\/(download|restore|detail)/)?"/backup":i}if(i){const e=function(){let e=i;const s=h.jetpack||h.single_user_site?"/posts":"/posts/my";e=e.replace(/^\/posts\b(\/my)?/,s),e.match(/^\/stats\/(post|page)\//)&&(e="/stats");e.match(/^\/domains\/manage\//)&&(e="/domains/manage");e.match(/^\/email\//)&&(e="/email");if(e.match(/^\/store\/stats\//)){h.jetpack&&h.options&&h.options.woocommerce_is_active||(e="/stats/day")}e.match(/^\/backup\/.*\/(download|restore|detail)/)&&(e="/backup");return e}(),s=(0,o.D)(e),{origin:t,pathname:r,search:a}=(0,n.A)(e),c=`${r}/${h.slug}`;try{const e=(0,n.C)({origin:t||window.location.origin,pathname:c,search:a});return(0,l.Z)(e,s)}catch{return null}}}();d&&S()(d)},recordTracksEvent:x.jN}))(te)},"./components/site-selector/utils.ts":(e,s,t)=>{t.d(s,{h:()=>l,D:()=>r});var i=t("../node_modules/lodash-es/get.js"),o=t("./lib/jetpack/is-jetpack-cloud.ts");const n=e=>(0,o.Z)()?(e=>`jetpack_${e}`)(e):e;function l(e){return(0,i.Z)(e,n("site_count"),0)}function r(e){return(0,i.Z)(e,n("visible_site_count"),0)}},"./lib/scroll-into-viewport/index.js":(e,s,t)=>{t.d(s,{Z:()=>l});const i="undefined"!=typeof document&&document.documentElement&&"scrollBehavior"in document.documentElement.style;function o(e,s,t,i=0){return i+=e[s],e[t]?o(e[t],s,t,i):i}function n(e,s,t){const i=o(e,"offsetTop","offsetParent");if(!function(e,s){const t=window.scrollY,i=document.documentElement.clientHeight+window.scrollY;return e>t&&s<i}(i,i+e.offsetHeight)||"if-needed"!==t)try{window.scroll({top:i,left:0,behavior:s})}catch(e){window.scrollTo(0,i)}}function l(e,s={}){const{behavior:t="auto",block:o="start",scrollMode:l="always",...r}=s;if(e)if(!e.scrollIntoViewIfNeeded||"auto"!==t&&i||"center"!==o&&"nearest"!==o||"if-needed"!==l||void 0!==r){if(e.scrollIntoView)try{return void e.scrollIntoView(s)}catch(e){}n(e,t,l)}else e.scrollIntoViewIfNeeded("center"===o)}},"./my-sites/sidebar/static-data/all-sites-menu.js":(e,s,t)=>{t.d(s,{Z:()=>o});var i=t("../packages/i18n-calypso/src/index.js");function o({showManagePlugins:e=!1}={}){return[{icon:"dashicons-chart-bar",slug:"stats",title:(0,i.Iu)("Stats"),navigationLabel:(0,i.Iu)("View stats for all sites"),type:"menu-item",url:"/stats/day"},{icon:"dashicons-cart",slug:"upgrades",title:(0,i.Iu)("Domains"),navigationLabel:(0,i.Iu)("View domains for all sites"),type:"menu-item",url:"/domains/manage"},{icon:"dashicons-admin-post",slug:"edit-php",title:(0,i.Iu)("Posts"),navigationLabel:(0,i.Iu)("View posts for all sites"),type:"menu-item",url:"/posts"},{icon:"dashicons-admin-page",slug:"edit-phppost_typepage",title:(0,i.Iu)("Pages"),navigationLabel:(0,i.Iu)("View pages for all sites"),type:"menu-item",url:"/pages"},{icon:"dashicons-admin-plugins",slug:"plugins",title:(0,i.Iu)("Plugins"),navigationLabel:(0,i.Iu)("View plugins for all sites"),type:"menu-item",url:"/plugins",...e&&{children:[{parent:"plugins",slug:"all-sites-plugins-add-new",title:(0,i.Iu)("Add New"),type:"submenu-item",url:"/plugins"},{parent:"plugins",slug:"all-sites-plugins-installed-plugins",title:(0,i.Iu)("Installed Plugins"),type:"submenu-item",url:"/plugins/manage"}]}}]}},"./state/selectors/are-all-sites-single-user.js":(e,s,t)=>{t.d(s,{Z:()=>l});var i=t("../packages/state-utils/src/index.ts"),o=t("./state/selectors/get-sites-items.ts"),n=t("./state/sites/selectors/is-single-user-site.js");const l=(0,i.P1)((e=>{const s=Object.keys((0,o.Z)(e));return!!s.length&&s.every((s=>(0,n.Z)(e,s)))}),o.Z)},"./state/selectors/can-any-site-have-plugins.ts":(e,s,t)=>{t.d(s,{y:()=>r});var i=t("../packages/state-utils/src/index.ts"),o=t("./state/selectors/can-current-user.js"),n=t("./state/selectors/get-sites.js"),l=t("./state/sites/selectors/is-jetpack-site.ts");t("./state/ui/init.js");const r=(0,i.P1)((e=>(0,n.Z)(e).some((s=>s&&(0,l.Z)(e,s.ID)&&(0,o.i)(e,s.ID,"manage_options")&&s.visible))),(e=>[e.sites.items,e.currentUser.capabilities]))},"./state/selectors/get-visible-sites.js":(e,s,t)=>{t.d(s,{Z:()=>l});var i=t("../packages/state-utils/src/index.ts"),o=t("./state/selectors/get-sites-items.ts"),n=t("./state/sites/selectors/get-site.js");const l=(0,i.P1)((e=>Object.values((0,o.Z)(e)).filter((e=>!0===e.visible)).map((s=>(0,n.Z)(e,s.ID)))),(e=>[(0,o.Z)(e)]))},"./state/selectors/has-loaded-sites.js":(e,s,t)=>{function i(e){return null!==e.sites.items}t.d(s,{Z:()=>i})}}]);