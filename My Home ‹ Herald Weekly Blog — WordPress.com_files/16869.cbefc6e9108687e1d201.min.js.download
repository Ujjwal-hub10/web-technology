"use strict";(globalThis.webpackChunkcalypso=globalThis.webpackChunkcalypso||[]).push([[16869],{"./lib/query-manager/key.js":(e,t,s)=>{s.d(t,{Z:()=>u});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=s("../node_modules/lodash-es/omitBy.js"),i=s("../node_modules/lodash-es/sortBy.js");class u{static omit(e){const{OMIT_NULL_VALUES:t,DEFAULT_QUERY:s}=this;return t||s?(0,n.Z)(e,((e,r)=>!(!t||null!==e)||!(!s||s[r]!==e))):e}static stringify(e){const t=this.omit(e),s=(0,i.Z)(Object.entries(t),(e=>e[0]));return JSON.stringify(s)}static parse(e){return this.omit(Object.fromEntries(JSON.parse(e)))}}(0,r.Z)(u,"DEFAULT_QUERY",null),(0,r.Z)(u,"OMIT_NULL_VALUES",!1)},"./lib/query-manager/paginated/constants.js":(e,t,s)=>{s.d(t,{t:()=>r,H:()=>n});const r={number:20,page:1},n=["number","offset","page"]},"./lib/query-manager/paginated/index.js":(e,t,s)=>{s.d(t,{Z:()=>K});var r=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=s("../node_modules/lodash-es/omit.js"),i=s("../node_modules/lodash-es/cloneDeep.js"),u=s("../node_modules/lodash-es/range.js"),o=s("../node_modules/lodash-es/values.js"),a=s("../node_modules/lodash-es/get.js"),c=s("../node_modules/lodash-es/reduce.js"),m=s("../node_modules/lodash-es/isEqual.js"),d=s("../node_modules/lodash-es/clone.js"),l=s("../node_modules/lodash-es/map.js"),y=s("../node_modules/lodash-es/difference.js"),h=s("./lib/query-manager/key.js");const g="__DELETE",f=new WeakMap,p=[];class b{constructor(e,t){this.data=Object.assign({items:{},queries:{}},e),this.options=Object.assign({itemKey:"ID"},t)}static mergeItem(e,t,s=!1){if(s){if(t.__DELETE)return;return Object.assign({},e,t)}return t}static matches(e,t){return!!t}static compare(e,t,s){return t===s?0:s-t}static sort(e,t,s){e.sort(((e,r)=>t[e]&&t[r]?this.compare(s,t[e],t[r]):0))}getItem(e){return this.data.items[e]}getItems(e){let t=null;if(e){const s=this.constructor.QueryKey.stringify(e);if(t=this.data.queries[s]?.itemKeys,!t)return null}return function(e,t){let s=f.get(e);if(s||(s=new WeakMap,f.set(e,s)),null==t){let t=s.get(p);return t||(t=(0,o.Z)(e),s.set(p,t)),t}let r=s.get(t);return r||(r=t.map((t=>e[t])),s.set(t,r)),r}(this.data.items,t)}getFound(e){const t=this.constructor.QueryKey.stringify(e);return(0,a.Z)(this.data.queries,[t,"found"],null)}removeItem(e){return this.removeItems([e])}removeItems(e=[]){return this.receive(e.map((e=>({[this.options.itemKey]:e,[g]:!0}))),{patch:!0})}receive(e=[],t={}){Array.isArray(e)||(e=[e]);const s=(0,c.Z)(e,((e,s)=>{const r=s[this.options.itemKey],i=this.getItem(r),u=this.constructor.mergeItem(i,s,t.patch);return void 0===u?i?(0,n.Z)(e,r):e:(i&&(0,m.Z)(u,i)||(e===this.data.items&&(e=(0,d.Z)(e)),e[r]=u),e)}),this.data.items);let r,i=s!==this.data.items,u=this.data.queries,o=!1;if(!i&&!t.query)return this;if(t.query){const s=(0,l.Z)(e,this.options.itemKey);let n,c;if(r=this.constructor.QueryKey.stringify(t.query),o=!this.data.queries[r],!o&&(0,m.Z)(this.data.queries[r].itemKeys,s)||(n=t.mergeQuery&&!o?(0,y.Z)(this.data.queries[r].itemKeys,s):s),t.found>=0&&t.found!==(0,a.Z)(u,[r,"found"])&&(c=t.found),n||c>=0){i=!0;const e=Object.assign({},u[r]);n&&(e.itemKeys=n),c>=0&&(e.found=c),u=Object.assign({},u,{[r]:e})}}return u=(0,c.Z)(u,((n,u,c)=>{n[c]=u;const m=r&&r===c;if(m&&(o||!t.mergeQuery))return n;if(!m&&t.dontShareQueryResultsWhenQueriesAreDifferent)return n;const l=!m,y=this.constructor.QueryKey.parse(c);let h=!1;return e.forEach((e=>{const t=e[this.options.itemKey],r=s[t],i=n[c].itemKeys.indexOf(t);-1!==i?r&&this.constructor.matches(y,r)||(n[c]===u&&(n[c]=(0,d.Z)(u)),n[c].itemKeys=[...n[c].itemKeys.slice(0,i),...n[c].itemKeys.slice(i+1)],l&&Number.isFinite(n[c].found)&&n[c].found--):r&&this.constructor.matches(y,r)&&(n[c]===u&&(n[c]=(0,d.Z)(u)),l&&Number.isFinite(n[c].found)&&n[c].found++,n[c].itemKeys=(0,a.Z)(n,[c,"itemKeys"],[]).concat(t),h=!0)})),h&&this.constructor.sort(n[c].itemKeys,s,y),i=i||n[c]!==u,n}),{}),i?new this.constructor(Object.assign({},this.data,{items:s,queries:u}),this.options):this}}(0,r.Z)(b,"QueryKey",h.Z);var j=s("./lib/query-manager/paginated/constants.js"),Z=s("./lib/query-manager/paginated/key.js");const q=new WeakMap;class K extends b{static hasQueryPaginationKeys(e){return!!e&&j.H.some((t=>e.hasOwnProperty(t)))}getItems(e){if(!e)return super.getItems(e);const t=this.getItemsIgnoringPage(e,!0);if(!t)return t;const s=e.page||this.constructor.DefaultQuery.page,r=e.number||this.constructor.DefaultQuery.number;return function(e,t,s){let r=q.get(e);r||(r=new Map,q.set(e,r));const n=`${t}/${s}`;let i=r.get(n);return i||(i=e.slice(t,t+s),r.set(n,i)),i}(t,(s-1)*r,r)}getItemsIgnoringPage(e,t=!1){if(!e)return null;const s=super.getItems((0,n.Z)(e,j.H));return!s||t?s:s.filter((e=>void 0!==e))}getNumberOfPages(e){const t=this.getFound(e);if(null===t)return t;const s=e.number||this.constructor.DefaultQuery.number;return Math.ceil(t/s)}receive(e,t={}){let s=t;t.query&&(s=Object.assign({mergeQuery:!0},t,{query:(0,n.Z)(t.query,j.H)}));const r=super.receive(e,s);if(this===r)return r;if(!this.constructor.hasQueryPaginationKeys(t.query))return r;const o=this.constructor.QueryKey.stringify(t.query),a=t.query.page||this.constructor.DefaultQuery.page,c=t.query.number||this.constructor.DefaultQuery.number,m=(a-1)*c,d=r.data.queries[o];Array.isArray(e)||(e=[e]);const l=e.map((e=>e[this.options.itemKey])),y=(0,i.Z)(d);if(y.hasOwnProperty("found")&&e.length<c){const e=this.data.queries[o];e&&e.hasOwnProperty("found")&&(y.found=Math.max(e.found,y.found))}return y.itemKeys=[...(0,u.Z)(0,m).map((e=>{const t=d.itemKeys[e];if(!l.includes(t))return t})),...(0,u.Z)(0,c).map((e=>l[e])),...d.itemKeys.slice(m+c).filter((e=>e&&!l.includes(e)))],y.hasOwnProperty("found")&&(y.itemKeys=(0,u.Z)(0,y.found).map((e=>y.itemKeys[e]))),new this.constructor(Object.assign({},r.data,{queries:Object.assign({},r.data.queries,{[o]:y})}),r.options)}}(0,r.Z)(K,"QueryKey",Z.Z),(0,r.Z)(K,"DefaultQuery",j.t)},"./lib/query-manager/paginated/key.js":(e,t,s)=>{s.d(t,{Z:()=>u});var r=s("../node_modules/lodash-es/omit.js"),n=s("./lib/query-manager/key.js"),i=s("./lib/query-manager/paginated/constants.js");class u extends n.Z{static stringify(e){return super.stringify((0,r.Z)(e,i.H))}static parse(e){return(0,r.Z)(super.parse(e),i.H)}}},"./lib/query-manager/with-query-manager.js":(e,t,s)=>{function r(e,t,s,r){if(!t)return e;const n=e[t]||r&&r();if(!n)return e;const i=s(n);return i===n?e:{...e,[t]:i}}s.d(t,{Z:()=>r})}}]);